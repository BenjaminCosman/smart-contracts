@startuml liquidExitingPool
actor PoolParticipant

PoolParticipant -> TrueFiPool : **exit** pool
activate TrueFiPool

TrueFiPool <- TrueFiPool: check if at least one block has passed from joining
TrueFiPool <- TrueFiPool: **ensureEnoughTokensAreAvailable**
TrueFiPool <- TrueFiPool: **burn** pool tokens


opt when TrueFiPool's balance is not enough

    TrueFiPool <- TrueFiPool: calculate **liquidExitPenalty**
    TrueFiPool -> CurvePool: **removeLiquidity** to match TUSD balance, to repay PoolParticipant

    activate CurvePool
    CurvePool -> TUSD: request **transfer** TUSD to TrueFiPool's balance
    
    activate TUSD
    TUSD <- TUSD: performs **transfer**
    CurvePool <-- TUSD
    deactivate TUSD

    deactivate CurvePool
    end

TrueFiPool -> TUSD: request **transfer** to PoolParticipant's balance

activate TUSD
TUSD <- TUSD: performs **transfer**
TrueFiPool <-- TUSD
deactivate TUSD

PoolParticipant <-- TrueFiPool
deactivate TrueFiPool
@enduml